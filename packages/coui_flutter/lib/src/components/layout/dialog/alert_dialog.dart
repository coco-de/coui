import 'package:coui_flutter/coui_flutter.dart';

/// A modal dialog component for displaying important alerts and confirmations.
///
/// AlertDialog provides a focused overlay interface for critical user interactions
/// that require immediate attention or confirmation. Built on top of [ModalBackdrop]
/// and [ModalContainer], it ensures proper accessibility and visual hierarchy.
///
/// The dialog features a flexible layout system supporting optional leading/trailing
/// icons, title text, descriptive content, and customizable action buttons. All
/// elements automatically adapt to the current theme's color scheme and scaling.
///
/// Key features:
/// - Modal presentation with backdrop blur and overlay
/// - Flexible content layout with optional elements
/// - Automatic theme integration and responsive scaling
/// - Customizable surface effects (blur, opacity)
/// - Action button layout with proper spacing
/// - Safe area handling for various screen sizes
///
/// The component is a StatefulWidget to manage internal modal state and
/// ensure proper lifecycle management during show/hide transitions.
///
/// Example:
/// ```dart
/// AlertDialog(
///   leading: Icon(Icons.warning),
///   title: Text('Delete Item'),
///   content: Text('Are you sure you want to delete this item?'),
///   actions: [
///     Button.ghost(onPressed: () => Navigator.pop(context), child: Text('Cancel')),
///     Button.destructive(onPressed: _deleteItem, child: Text('Delete')),
///   ],
/// );
/// ```
class AlertDialog extends StatefulWidget {
  /// Creates an [AlertDialog].
  ///
  /// All parameters are optional, allowing for flexible dialog configurations
  /// from simple text alerts to complex confirmation interfaces.
  ///
  /// Parameters:
  /// - [leading] (Widget?, optional): Icon or graphic at dialog start
  /// - [title] (Widget?, optional): Primary dialog heading
  /// - [content] (Widget?, optional): Detailed description or message
  /// - [actions] (List<Widget>?, optional): Action buttons for user response
  /// - [trailing] (Widget?, optional): Additional controls at dialog end
  /// - [surfaceBlur] (double?, optional): Backdrop blur intensity
  /// - [surfaceOpacity] (double?, optional): Backdrop opacity level
  /// - [barrierColor] (Color?, optional): Backdrop overlay color
  /// - [padding] (EdgeInsetsGeometry?, optional): Internal content padding
  ///
  /// Example:
  /// ```dart
  /// AlertDialog(
  ///   title: Text('Confirm Action'),
  ///   content: Text('This action cannot be undone.'),
  ///   actions: [
  ///     TextButton(onPressed: () => Navigator.pop(context), child: Text('Cancel')),
  ///     ElevatedButton(onPressed: _confirm, child: Text('Confirm')),
  ///   ],
  /// );
  /// ```
  const AlertDialog({
    this.actions,
    this.barrierColor,
    this.content,
    super.key,
    this.leading,
    this.padding,
    this.surfaceBlur,
    this.surfaceOpacity,
    this.title,
    this.trailing,
  });

  /// Optional leading widget, typically an icon or graphic.
  ///
  /// Type: `Widget?`. Displayed at the start of the dialog header with
  /// automatic icon styling (XL size, muted foreground color).
  final Widget? leading;

  /// Optional trailing widget for additional dialog controls.
  ///
  /// Type: `Widget?`. Positioned at the end of the dialog header with
  /// similar styling to the leading widget.
  final Widget? trailing;

  /// Optional title widget for the dialog header.
  ///
  /// Type: `Widget?`. Displayed prominently with large, semi-bold text styling.
  /// Should contain the primary message or question for the user.
  final Widget? title;

  /// Optional content widget for detailed dialog information.
  ///
  /// Type: `Widget?`. Provides additional context or description with
  /// small, muted text styling. Positioned below the title.
  final Widget? content;

  /// Optional list of action buttons for user interaction.
  ///
  /// Type: `List<Widget>?`. Buttons are arranged horizontally at the bottom
  /// of the dialog with consistent spacing. Typically includes cancel and
  /// confirmation options.
  final List<Widget>? actions;

  /// Surface blur intensity for the modal backdrop.
  ///
  /// Type: `double?`. If null, uses theme default blur value.
  /// Higher values create more pronounced background blur effects.
  final double? surfaceBlur;

  /// Surface opacity for the modal backdrop.
  ///
  /// Type: `double?`. If null, uses theme default opacity value.
  /// Controls the transparency level of the backdrop overlay.
  final double? surfaceOpacity;

  /// Barrier color for the modal backdrop.
  ///
  /// Type: `Color?`. If null, defaults to black with 80% opacity.
  /// The color overlay applied behind the dialog content.
  final Color? barrierColor;

  /// Internal padding for the dialog content.
  ///
  /// Type: `EdgeInsetsGeometry?`. If null, uses responsive padding
  /// based on theme scaling (24 * scaling). Controls spacing around
  /// all dialog content.
  final EdgeInsetsGeometry? padding;

  @override
  _AlertDialogState createState() => _AlertDialogState();
}

class _AlertDialogState extends State<AlertDialog> {
  @override
  Widget build(BuildContext context) {
    final themeData = Theme.of(context);
    final scaling = themeData.scaling;

    return ModalBackdrop(
      barrierColor: widget.barrierColor ?? Colors.black.withValues(alpha: 0.8),
      borderRadius: themeData.borderRadiusXxl,
      surfaceClip: ModalBackdrop.shouldClipSurface(
        widget.surfaceOpacity ?? themeData.surfaceOpacity,
      ),
      child: ModalContainer(
        borderColor: themeData.colorScheme.muted,
        borderRadius: themeData.borderRadiusXxl,
        borderWidth: scaling * 1,
        fillColor: themeData.colorScheme.popover,
        filled: true,
        padding: widget.padding ?? EdgeInsets.all(scaling * 24),
        surfaceBlur: widget.surfaceBlur ?? themeData.surfaceBlur,
        surfaceOpacity: widget.surfaceOpacity ?? themeData.surfaceOpacity,
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.end,
          mainAxisSize: MainAxisSize.min,
          children: [
            Flexible(
              child: Row(
                crossAxisAlignment: CrossAxisAlignment.start,
                mainAxisSize: MainAxisSize.min,
                children: [
                  if (widget.leading != null)
                    widget.leading!.iconXLarge().iconMutedForeground(),
                  if (widget.title != null || widget.content != null)
                    Flexible(
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        mainAxisSize: MainAxisSize.min,
                        children: [
                          if (widget.title != null)
                            widget.title!.large().semiBold(),
                          if (widget.content != null)
                            widget.content!.small().muted(),
                        ],
                      ).gap(scaling * 8),
                    ),
                  if (widget.trailing != null)
                    widget.trailing!.iconXLarge().iconMutedForeground(),
                ],
              ).gap(scaling * 16),
            ),
            if (widget.actions != null && widget.actions!.isNotEmpty)
              Row(
                mainAxisAlignment: MainAxisAlignment.end,
                mainAxisSize: MainAxisSize.min,
                children: join(
                  widget.actions!,
                  SizedBox(width: scaling * 8),
                ).toList(),
              ),
          ],
        ).gap(scaling * 16),
      ),
    );
  }
}
